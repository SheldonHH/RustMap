        -:    0:Source:main.c
        -:    0:Graph:main.gcno
        -:    0:Data:-
        -:    0:Runs:0
        -:    0:Programs:0
        -:    1:#include <stdio.h>
        -:    2:#include <sys/mman.h>
        -:    3:#include <string.h>
        -:    4: 
    #####:    5:int test (int a, int b)
        -:    6:{
        -:    7:  /*
        -:    8:       mov EAX, [ESP+4]
        -:    9:       add EAX, [ESP+8]
        -:   10:       ret
        -:   11:  */
    #####:   12:  char code[] = {0x8B, 0x44, 0x24, 0x4, 0x3, 0x44, 0x24, 0x8, 0xC3};
        -:   13:  void *buf;
        -:   14:  int c;
        -:   15:  /* copy code to executable buffer */
    #####:   16:  buf = mmap (0,sizeof(code),PROT_READ|PROT_WRITE|PROT_EXEC,
        -:   17:             MAP_PRIVATE|MAP_ANON,-1,0);
        -:   18: 
    #####:   19:  memcpy (buf, code, sizeof(code));
        -:   20:  /* run code */
    #####:   21:  c = ((int (*) (int, int))buf)(a, b);
        -:   22:  /* free buffer */
    #####:   23:  munmap (buf, sizeof(code));
    #####:   24:  return c;
        -:   25:}
        -:   26: 
    #####:   27:int main ()
        -:   28:{
    #####:   29:  printf("%d\n", test(7,12));
    #####:   30:  return 0;
        -:   31:}
